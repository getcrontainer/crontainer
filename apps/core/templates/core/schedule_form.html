{% extends 'core/base2.html' %}
{% load widget_tweaks %}
{% load describe_cron %}
{% block content %}
    <form action="." method="POST">
        {% csrf_token %}
        <h3>Schedules :: Create</h3>
        {{ form.non_field_errors }}
        <div class="">
            <div>
                {{ form.name|add_label_class:"block p-1" }}
                {{ form.name|add_class:"rounded-md w-full border-gray-300"|add_error_class:"text-red-400" }}
                <span class="text-red-500 text-sm">{{ form.name.errors }}</span>
            </div>
            <div>
                {{ form.cron_rule|add_label_class:"block p-1" }}
                {{ form.cron_rule|add_class:"rounded-md w-full border-gray-300"|add_error_class:"text-red-400" }}
                <span id="cron-description" class="text-gray-500 dark:text-gray-300">
                    {% if form.cron_rule.value %}{{ form.cron_rule.value|describe_cron }}{% endif %}
                </span>
                <span class="text-red-500 text-sm">{{ form.cron_rule.errors }}</span>
            </div>
            <div id="env-vars-container">
                {{ form.env_vars|add_label_class:"block p-1" }}
                <div id="env-vars-list">
                    {% for key, value in form.instance.env_vars.items %}
                        <div class="env-var-field">
                            <input type="text"
                                   name="env_vars_keys"
                                   class="rounded-md border-gray-300"
                                   placeholder="Name"
                                   value="{{ key }}">
                            <input type="text"
                                   name="env_vars_values"
                                   class="rounded-md border-gray-300"
                                   placeholder="Value"
                                   value="{{ value }}">
                            <button type="button"
                                    class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900"
                                    onclick="this.parentElement.remove()">
                                <span class="mdi mdi-close-thick"></span>
                            </button>
                        </div>
                    {% endfor %}
                </div>
                <button type="button"
                        class="focus:outline-none text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800"
                        onclick="addEnvVar()">
                    <span class="mdi mdi-plus-thick"></span>
                </button>
            </div>
            <div>
                {{ form.image|add_label_class:"block p-1" }}
                {{ form.image|add_class:"rounded-md w-full border-gray-300" }}
            </div>
            <div>
                {{ form.credential|add_label_class:"block p-1" }}
                {{ form.credential|add_class:"rounded-md w-full border-gray-300" }}
            </div>
            <div>
                {{ form.cmd|add_label_class:"block p-1" }}
                {{ form.cmd|add_class:"rounded-md w-full border-gray-300" }}
            </div>
            <div class="flex">
                <div class="me-2">
                    {{ form.cpu|add_label_class:"block p-1" }}
                    {{ form.cpu|add_class:"rounded-md w-full border-gray-300" }}
                </div>
                <div class="ms-2">
                    {{ form.memory|add_label_class:"block p-1" }}
                    {{ form.memory|add_class:"rounded-md w-full border-gray-300" }}
                </div>
            </div>
            <div>
                {{ form.active|add_class:"rounded" }} Active
                <p class="mt-2 text-gray-600 text-sm">{{ form.active.help_text }}</p>
            </div>
            <div>
                {{ form.singleton|add_class:"rounded" }} Singleton
                <p class="mt-2 text-gray-600 text-sm">{{ form.singleton.help_text }}</p>
            </div>
        </div>
        <div class="text-right">
            <button type="submit"
                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                Save
            </button>
        </div>
    </form>
{% endblock %}
{% block footer %}
    <script>
        function addEnvVar() {
            const envVarField = document.createElement('div');
            envVarField.classList.add('env-var-field');
            envVarField.innerHTML = `
                <input type="text" name="env_vars_keys" class="rounded-md border-gray-300" placeholder="Name">
                <input type="text" name="env_vars_values" class="rounded-md border-gray-300" placeholder="Value">
                <button type="button" class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900" onclick="this.parentElement.remove()">
                    <span class="mdi mdi-close-thick"></span>
                </button>
            `;
            document.getElementById('env-vars-list').appendChild(envVarField);
        }
    </script>
{% endblock %}
